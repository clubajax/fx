<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 5//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <title>Test fx</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/2.5.3/mocha.css">
    <script src="https://rawgit.com/clubajax/dom/v1.1.0/src/dom.js"></script>
    <script src="https://rawgit.com/clubajax/on/master/src/key-poly.js"></script>
    <script src="https://rawgit.com/clubajax/on/master/src/on.js"></script>
    <script src="../src/fx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/2.5.3/mocha.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/3.5.0/chai.min.js"></script>
    <style>
        body{
            padding: 20px;
            font-family: sans-serif;
        }
        .fade-me{
            border: 1px solid #666;
            background: #ffb5b7;
            padding: 10px;
            display: inline-block;
            margin: 20px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h1>fx test</h1>
    <div id="mocha"></div>
    <div class="fade-me" id="1">
        This div is for opacity tests
    </div>
    <script>

        mocha.setup('tdd');

        suite('fx', function() {

            var suite = window.suite,
                test = window.test,
                dom = window.dom,
                on = window.on,
                expect = chai.expect;

            function xsuite () {}
            function xtest () {}
            xsuite('fx.opacity', function () {
                test('it should use opacity to fade out and in', function (done) {
                    var node = dom.byId('1');
                    fx.opacity(node, {
                        opacity: 0,
                        speed: 200,
                        callback: function () {
                            expect(dom.style(node, 'opacity')).to.equal(0);
                            fx.opacity(node, {
                                opacity: 1,
                                speed: 200,
                                callback: function () {
                                    expect(dom.style(node, 'opacity')).to.equal(1);
                                    done();
                                }
                            });
                        }
                    });
                });

                test('it should use opacity to fade out and in immediately', function (done) {
                    var node = dom.byId('1');
                    fx.opacity(node, {
                        opacity: 0,
                        immediate: true,
                        callback: function () {
                            expect(dom.style(node, 'opacity')).to.equal(0);
                            fx.opacity(node, {
                                opacity: 1,
                                immediate: true,
                                callback: function () {
                                    expect(dom.style(node, 'opacity')).to.equal(1);
                                    done();
                                }
                            });
                        }
                    });
                });

                test('it should use opacity to fade out to 0.2 and back in', function (done) {
                    var node = dom.byId('1');
                    fx.opacity(node, {
                        speed: 200,
                        opacity: 0.2,
                        callback: function () {
                            expect(dom.style(node, 'opacity')).to.equal(0.2);
                            fx.opacity(node, {
                                speed: 200,
                                opacity: 0.7,
                                callback: function () {
                                    expect(dom.style(node, 'opacity')).to.equal(0.7);
                                    done();
                                }
                            });
                        }
                    });
                });
            });

            xsuite('fx.fade', function () {
                test('it should fade out and in', function (done) {
                    var node = dom.byId('1');
                    fx.fade.out(node, {
                        speed: 200,
                        callback: function () {
                            expect(dom.style(node, 'opacity')).to.equal(0);
                            fx.fade.in(node, {
                                speed: 200,
                                callback: function () {
                                    expect(dom.style(node, 'opacity')).to.equal(1);
                                    done();
                                }
                            });
                        }
                    });
                });

                test('it should fade out and in immediately', function (done) {
                    var node = dom.byId('1');
                    fx.fade.out(node, {
                        immediate: true,
                        callback: function () {
                            expect(dom.style(node, 'opacity')).to.equal(0);
                            fx.fade.in(node, {
                                immediate: true,
                                callback: function () {
                                    expect(dom.style(node, 'opacity')).to.equal(1);
                                    done();
                                }
                            });
                        }
                    });
                });

                test('it should fade out to 0.5 and back in', function (done) {
                    var node = dom.byId('1');
                    fx.fade.out(node, {
                        speed: 200,
                        opacity: 0.2,
                        callback: function () {
                            expect(dom.style(node, 'opacity')).to.equal(0.2);
                            fx.fade.in(node, {
                                speed: 200,
                                opacity: 0.7,
                                callback: function () {
                                    expect(dom.style(node, 'opacity')).to.equal(0.7);
                                    done();
                                }
                            });
                        }
                    });
                });
            });

            suite('fx.height', function () {
                xtest('it should collapse and expand', function (done) {
                    var node = dom.byId('1');
                    fx.height(node, {
                        height: 0,
                        speed: 100,
                        callback: function () {
                            expect(node.style.height).to.equal('0px');
                            expect(node.style.paddingTop).to.equal('0px');
                            fx.height(node, {
                                height: 100,
                                speed: 100,
                                callback: function () {
                                    expect(dom.box(node).height).to.equal(100);
                                    expect(node.style.paddingTop).to.equal('10px');
                                    fx.height(node, {
                                        height: 'auto',
                                        speed: 100,
                                        callback: function () {
                                            expect(dom.box(node).height).to.equal(40);
                                            expect(node.style.paddingTop).to.equal('10px');
                                            done();
                                        }
                                    });
                                }
                            });
                        }
                    });
                });

                test('it should collapse and expand without border-box styling', function (done) {
                    var node = dom.byId('1');
                    node.style.boxSizing = 'content-box';
                    fx.height(node, {
                        height: 0,
                        speed: 100,
                        callback: function () {
                            expect(node.style.height).to.equal('0px');
                            expect(node.style.paddingTop).to.equal('0px');
                            fx.height(node, {
                                height: 100,
                                speed: 100,
                                callback: function () {
                                    expect(dom.box(node).height).to.equal(122);
                                    expect(node.style.paddingTop).to.equal('10px');
                                    fx.height(node, {
                                        height: 'auto',
                                        speed: 100,
                                        callback: function () {
                                            expect(dom.box(node).height).to.equal(40);
                                            expect(node.style.paddingTop).to.equal('10px');
                                            done();
                                        }
                                    });
                                }
                            });
                        }
                    });
                });
            });
        });

        mocha.run();
    </script>
</body>
</html>